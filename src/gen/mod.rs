mod rewrite;
mod transfer;

use crate::{Aig, Mig, Network, RewriteCallback, RewriteFFI, TransferFFI, Xag, Xmg};
use indoc::formatdoc;

trait StructFFI {
    fn struct_name() -> String;
    fn struct_definition() -> String;
}

pub fn network_ffi<N: Network>() -> String {
    formatdoc!(
        "{}{}{}{}{}{}",
        <N::TransferFFI as StructFFI>::struct_definition(),
        RewriteCallback::<N>::struct_definition(),
        RewriteFFI::<N>::struct_definition(),
        transfer::transfer_helper::<N>(),
        transfer::receive_helper::<N>(),
        rewrite::rewrite_helper::<N>()
    )
}


pub fn ffi_header() -> String {
    formatdoc!(
        r#"
        // Automatically generated by eggmock v{}
        #pragma once

        #include <cstddef>
        #include <cstdint>
        #include <stdexcept>

        #include <mockturtle/mockturtle.hpp>

        namespace eggmock
        {{

        {}
        {}
        {}
        {}
        }}
        "#,
        env!("CARGO_PKG_VERSION"),
        network_ffi::<Mig>(),
        network_ffi::<Aig>(),
        network_ffi::<Xag>(),
        network_ffi::<Xmg>()
    )
}